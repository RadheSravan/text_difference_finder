<html>
  <head>
    <style>
      .bold-italic {
        font-weight: bold;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div id="results"></div>

    <script>
      function showTextDiffResult(s1, s2, expected) {
        let result = "<p>" +
                     "<div><span class='bold-italic'>Original text: </span>" + s1 + "</div>" +
                     "<div><span class='bold-italic'>Edited text: </span>" + s2 + "</div>" +
                     "<div><span class='bold-italic'>Expected result: </span>" + expected + "</div>" +
                     "<div><span class='bold-italic'>Actual result: </span>" + textDiff(s1, s2) + "</div>" +
                     "</p>";
        return result;
      }

      function textDiff(s1, s2) {
        let memo = Array(s1.length).fill(null).map(
          e => Array(s2.length).fill(null).map(
            e => Array(3).fill(null).map(
              e => Object()
            )
          )
        );

        let tdResultObj = TD(s1, s2, 0, 0, memo);
        return tdResultObj.result;
      }

      function append(resultArray, toAppend, isPartOfLCA) {
        if (resultArray[0][1] == isPartOfLCA) {
          resultArray[0][0] = toAppend + resultArray[0][0];
        } else {
          resultArray.unshift([toAppend, isPartOfLCA]);
        }
      }

      function TD(s1, s2, i1, i2, memo) {
        if (s1.length == i1 || s2.length == i2 ) {
          let result1 = s1.slice(i1, s1.length);
          let result2 = s2.slice(i2, s2.length);
          let resultObj = {result: "",
                           result1: [[result1, false]],
                           result2: [[result2, false]]}
          return resultObj;
        }

        if (memo[i1][i2]["result"] !== undefined) {
          return memo[i1][i2];
        }

        if (s1[i1] == s2[i2]) {
          let i1_current = i1;
          let i2_current = i2;
          let result_prefix = "";
          while(s1[i1_current] == s2[i2_current] &&
                i1_current < s1.length && i2_current < s2.length) {
            result_prefix += s1[i1_current];
            i1_current += 1;
            i2_current += 1;
          }

          let next_result = TD(s1, s2, i1_current, i2_current, memo);

          let resultObj = JSON.parse(JSON.stringify(next_result));
          resultObj["result"] = result_prefix + resultObj["result"];
          append(resultObj["result1"], result_prefix, true);
          append(resultObj["result2"], result_prefix, true);
          memo[i1][i2] = resultObj;
          return memo[i1][i2];
        }

        let resultObj;
        let resultA = TD(s1, s2, i1 + 1, i2, memo);
        let resultB = TD(s1, s2, i1, i2 + 1, memo);
        if(resultA.result.length >= resultB.result.length) {
          resultObj = JSON.parse(JSON.stringify(resultA));
          append(resultObj.result1, s1[i1], false);
        } else {
          resultObj = JSON.parse(JSON.stringify(resultB));
          append(resultObj.result2, s2[i2], false);
        }
        memo[i1][i2] = resultObj;
        return memo[i1][i2];
      }

      let TS0 = ["abcde", "bfkcdepqr", "bcde"];
      let TS1 = ["aaa", "bbb", ""];
      let TS2 = ["abc", "defg", ""];
      let TS3 = ["abd", "bcd", "bd"];
      let TS4 = ["abcddk", "afkddk", "addk"];
      let TS5 = ["breakfast I had tooday was aweeesome",
                      "the breakfast I had today was awesome",
                      "breakfast I had today was awesome"];
      let TS6 = [Array(500).join('a'), Array(700).join('b'), ""];
      let TS7 = ["ab", "ac", "a"];
      let TS8 = ["a", "a", "a"];

      // let testSets = [TS0, TS1, TS2, TS3, TS4, TS5];
      let testSets = [TS5];

      testSets.forEach(function(testSet) {
        document.getElementById("results").innerHTML +=
          showTextDiffResult(testSet[0], testSet[1], testSet[2]);
      });
    </script>
  </body>
</html>
